<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Database Test - Admin Dashboard</title>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  
  <!-- External CSS -->
  <link rel="stylesheet" href="styles.css">
  
  <style>
    .test-section {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }
    
    .test-result {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-md);
      margin-top: var(--spacing-md);
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .test-button {
      background: var(--accent-primary);
      color: white;
      border: none;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 500;
      margin-right: var(--spacing-sm);
    }
    
    .test-button:hover {
      background: var(--accent-primary-dark);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="logo">Database Test</div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content" role="main">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">Database Connection Test</h1>
      <p class="page-subtitle">Testing Supabase connection and data retrieval</p>
    </div>

    <!-- Blog Comments Test -->
    <div class="test-section">
      <h2>Blog Comments Table Test</h2>
      <button class="test-button" onclick="testBlogComments()">Test Blog Comments</button>
      <div id="blogCommentsResult" class="test-result"></div>
    </div>

    <!-- Gallery Images Test -->
    <div class="test-section">
      <h2>Gallery Images Table Test</h2>
      <button class="test-button" onclick="testGalleryImages()">Test Gallery Images</button>
      <div id="galleryImagesResult" class="test-result"></div>
    </div>

    <!-- Database Schema Test -->
    <div class="test-section">
      <h2>Database Schema Test</h2>
      <button class="test-button" onclick="testDatabaseSchema()">Test Schema</button>
      <div id="schemaResult" class="test-result"></div>
    </div>
  </main>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  
  <script>
    // Initialize Supabase client
    const supabase = window.supabase.createClient(
      'https://jitlnpliyugbmgmlgexx.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImppdGxucGxpeXVnYm1nbWxnZXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNjk3MjAsImV4cCI6MjA2OTk0NTcyMH0.cLysTIfJpeR0McvKUQxwBo-8K8ZcKm1ZNL9YqvLquIE'
    );

    // Test Blog Comments
    async function testBlogComments() {
      const resultDiv = document.getElementById('blogCommentsResult');
      resultDiv.textContent = 'Testing blog_comments table...';
      
      try {
        console.log('Testing blog_comments table...');
        
        const { data, error } = await supabase
          .from('blog_comments')
          .select('*')
          .order('created_at', { ascending: false });

        if (error) {
          resultDiv.textContent = `ERROR: ${error.message}\n\nDetails: ${JSON.stringify(error, null, 2)}`;
          return;
        }

        console.log('Blog comments data:', data);
        
        if (!data || data.length === 0) {
          resultDiv.textContent = 'No data found in blog_comments table.\n\nThis could mean:\n1. The table is empty\n2. The table doesn\'t exist\n3. There are permission issues';
          return;
        }

        // Show first few records with detailed info
        const sampleData = data.slice(0, 3);
        resultDiv.textContent = `SUCCESS: Found ${data.length} records\n\nSample data:\n${JSON.stringify(sampleData, null, 2)}`;
        
      } catch (error) {
        console.error('Error testing blog comments:', error);
        resultDiv.textContent = `EXCEPTION: ${error.message}\n\nStack: ${error.stack}`;
      }
    }

    // Test Gallery Images
    async function testGalleryImages() {
      const resultDiv = document.getElementById('galleryImagesResult');
      resultDiv.textContent = 'Testing gallery_images table...';
      
      try {
        console.log('Testing gallery_images table...');
        
        const { data, error } = await supabase
          .from('gallery_images')
          .select('*')
          .order('created_at', { ascending: false });

        if (error) {
          resultDiv.textContent = `ERROR: ${error.message}\n\nDetails: ${JSON.stringify(error, null, 2)}`;
          return;
        }

        console.log('Gallery images data:', data);
        
        if (!data || data.length === 0) {
          resultDiv.textContent = 'No data found in gallery_images table.\n\nThis could mean:\n1. The table is empty\n2. The table doesn\'t exist\n3. There are permission issues';
          return;
        }

        // Show first few records with detailed info
        const sampleData = data.slice(0, 3);
        resultDiv.textContent = `SUCCESS: Found ${data.length} records\n\nSample data:\n${JSON.stringify(sampleData, null, 2)}`;
        
      } catch (error) {
        console.error('Error testing gallery images:', error);
        resultDiv.textContent = `EXCEPTION: ${error.message}\n\nStack: ${error.stack}`;
      }
    }

    // Test Database Schema
    async function testDatabaseSchema() {
      const resultDiv = document.getElementById('schemaResult');
      resultDiv.textContent = 'Testing database schema...';
      
      try {
        console.log('Testing database schema...');
        
        // Test if we can access the tables at all
        const blogResult = await supabase
          .from('blog_comments')
          .select('*')
          .limit(1);

        const galleryResult = await supabase
          .from('gallery_images')
          .select('*')
          .limit(1);

        let schemaInfo = 'Database Schema Test Results:\n\n';
        
        // Blog Comments table info
        schemaInfo += 'BLOG_COMMENTS TABLE:\n';
        if (blogResult.error) {
          schemaInfo += `❌ Error: ${blogResult.error.message}\n`;
        } else {
          schemaInfo += `✅ Table accessible\n`;
          if (blogResult.data && blogResult.data.length > 0) {
            const sample = blogResult.data[0];
            schemaInfo += `Sample record fields: ${Object.keys(sample).join(', ')}\n`;
            schemaInfo += `Sample data: ${JSON.stringify(sample, null, 2)}\n`;
          } else {
            schemaInfo += `Table is empty\n`;
          }
        }
        
        schemaInfo += '\nGALLERY_IMAGES TABLE:\n';
        if (galleryResult.error) {
          schemaInfo += `❌ Error: ${galleryResult.error.message}\n`;
        } else {
          schemaInfo += `✅ Table accessible\n`;
          if (galleryResult.data && galleryResult.data.length > 0) {
            const sample = galleryResult.data[0];
            schemaInfo += `Sample record fields: ${Object.keys(sample).join(', ')}\n`;
            schemaInfo += `Sample data: ${JSON.stringify(sample, null, 2)}\n`;
          } else {
            schemaInfo += `Table is empty\n`;
          }
        }

        resultDiv.textContent = schemaInfo;
        
      } catch (error) {
        console.error('Error testing schema:', error);
        resultDiv.textContent = `EXCEPTION: ${error.message}\n\nStack: ${error.stack}`;
      }
    }
  </script>
</body>
</html>
